#!/bin/bash

# Android Pre-Commit Hook
# Runs Spotless and Detekt checks before committing

set -e

echo "Running pre-commit checks..."
echo ""

# Run Spotless check
echo "ğŸ“ Running Spotless check..."
if ./gradlew spotlessCheck --daemon; then
    echo "âœ… Spotless check passed"
else
    echo "âŒ Spotless check failed"
    echo ""
    echo "ğŸ’¡ Run './gradlew spotlessApply' to automatically fix formatting issues"
    exit 1
fi

echo ""

# Run Detekt
echo "ğŸ” Running Detekt analysis..."
if ./gradlew detekt --daemon; then
    echo "âœ… Detekt analysis passed"
else
    echo "âŒ Detekt found issues"
    echo ""
    echo "ğŸ’¡ Check the report at: build/reports/detekt/detekt.html"
    exit 1
fi

echo ""

# Run Android Lint on changed files
echo "ğŸ¤– Running Android Lint..."
if ./gradlew lintDebug --daemon; then
    echo "âœ… Android Lint passed"
else
    echo "âŒ Android Lint found issues"
    echo ""
    echo "ğŸ’¡ Check the report at: app/build/reports/lint-results-debug.html"
    exit 1
fi

echo ""
echo "âœ… All pre-commit checks passed!"